<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Containerized and rewritten in Golang. Automation, devops, coffee, repeat.">
    <meta name="author" content="Michael Fridman">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

    <link href="https://fonts.googleapis.com/css?family=Nunito|Roboto+Mono:500" rel="stylesheet"> <style type="text/css">
    body {
        font-family: 'Nunito', sans-serif;
        background-color: #fdfdfd;
        font-size: 1.1em;
    }

    .navbar {
        font-family: 'Roboto Mono', monospace;
        font-size: 1.6em;
    }

    .center {
        text-align: center;
    }

     

    html {
        position: relative;
        min-height: 100%;
    }

    body {
         
        margin-bottom: 60px;
    }

    .footer {
        position: absolute;
        bottom: 0;
        width: 100%;
         
        height: 60px;
        line-height: 60px;
         
    }

     

    pre{
        font-size: 80%;
    }

    hr {
        border: 0;
        height: 10;
        margin: 30px 0 30px 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    }



     

     

     

    code{
        font-size: 80%;
        color: #0086b3;
    }

    .prettyprint {
        font-size: 80%;
        background: #fff;
        font-family: Menlo, Bitstream Vera Sans Mono, DejaVu Sans Mono, Monaco, Consolas, monospace;
        border: 0 !important;
    }

    .pln {
        color: #333
    }

    ol.linenums {
        margin-top: 0;
        margin-bottom: 0;
        color: #ccc
    }

    li.L0,
    li.L1,
    li.L2,
    li.L3,
    li.L4,
    li.L5,
    li.L6,
    li.L7,
    li.L8,
    li.L9 {
        padding-left: 1em;
        background-color: #fff;
        list-style-type: decimal
    }

    @media screen {
        .str {
            color: #183691
        }
        .kwd {
            color: #a71d5d
        }
        .com {
            color: #969896
        }
        .typ {
            color: #0086b3
        }
        .lit {
            color: #0086b3
        }
        .pun {
            color: #333
        }
        .opn {
            color: #333
        }
        .clo {
            color: #333
        }
        .tag {
            color: navy
        }
        .atn {
            color: #795da3
        }
        .atv {
            color: #183691
        }
        .dec {
            color: #333
        }
        .var {
            color: teal
        }
        .fun {
            color: #900
        }
    }
</style>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>

</head>


<body onload="PR.prettyPrint()">
    <div class="container pt-2">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <nav class="navbar navbar-expand-md navbar-light bg-light rounded">
    <a class="navbar-brand px-3 mt-2" href="https://mfridman.github.com/frid.io/">M
        <img src="http://mfridman.com/assets/svg-icons/lovebot-icon.svg" alt="lovebot" width="28px"> F
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#myNavBar" aria-controls="myNavBar" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-center" id="myNavBar">
        <ul class="navbar-nav">
            <li class="nav-item pl-4">
                <a class="nav-link" href="https://mfridman.github.com/frid.io/">Home</a>
            </li>
            <li class="nav-item pl-4">
                <a class="nav-link" href="https://mfridman.github.com/frid.io/golang/">g<img src="http://mfridman.com/assets/svg-icons/gopher-icon.svg" alt="" width="24px">lang</a>
            </li>
            <li class="nav-item pl-4">
                <a class="nav-link" href="https://mfridman.github.com/frid.io/blog/">Blog</a>
            </li>
            <li class="nav-item pl-4">
                <a class="nav-link" href="https://mfridman.github.com/frid.io/ctf/">CTF</a>
            </li>
            <li class="nav-item pl-4">
                <a class="nav-link" href="https://mfridman.github.com/frid.io/about/">About</a>
            </li>
        </ul>
    </div>
</nav>
                <div class="mt-4">
                    
<h1>
    mindreader
    <br>
    <small class="text-muted" style="font-size:0.5em">
        Friday, Jun 23, 2017 &nbsp;&nbsp; | &nbsp;&nbsp; 
        
            <a href="https://mfridman.github.com/frid.io/tags/ctf">ctf</a>&nbsp;&nbsp; 
        
            <a href="https://mfridman.github.com/frid.io/tags/google">google</a>&nbsp;&nbsp; 
        
            <a href="https://mfridman.github.com/frid.io/tags/2017">2017</a>&nbsp;&nbsp; 
        
            <a href="https://mfridman.github.com/frid.io/tags/lfi">lfi</a>&nbsp;&nbsp; 
        
    </small>
</h1>

<hr> <p>2017 was a tough one. Nonetheless, big thanks to <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 272 92" width="68" height="23"><path fill="#EA4335" d="M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path fill="#FBBC05" d="M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.46-12.51 13.44c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z"/><path fill="#4285F4" d="M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z"/><path fill="#34A853" d="M225 3v65h-9.5V3h9.5z"/><path fill="#EA4335" d="M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z"/><path fill="#4285F4" d="M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z"/></svg> for hosting an event.</p>

<p>Challenge: Can you read my mind? No hints.</p>

<hr />

<p>All you get is an input box:</p>

<p><img src="https://mfridman.github.com/frid.io/img/input.png" alt="inputbox" style="width: 250px;"/></p>

<p>Checking the page source doesn&rsquo;t reveal anything fruitful. In hindsight the <code>name=&quot;f&quot;</code> may have been a clue, but it&rsquo;s subtle. (spoiler: f for file)</p>

<p><div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:100%;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 1</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 2</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 3</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 4</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 5</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 6</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 7</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 8</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f"> 9</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f">10</span><span style="margin-right:0.4em;padding:00.4em00.4em;display:block;color:#7f7f7f">11</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#309;font-weight:bold">html</span>&gt;
    &lt;<span style="color:#309;font-weight:bold">head</span>&gt;
    &lt;/<span style="color:#309;font-weight:bold">head</span>&gt;
    &lt;<span style="color:#309;font-weight:bold">body</span>&gt;
        &lt;<span style="color:#309;font-weight:bold">p</span>&gt;Hello, what do you want to read?&lt;/<span style="color:#309;font-weight:bold">p</span>&gt;
        &lt;<span style="color:#309;font-weight:bold">form</span> <span style="color:#309">method</span><span style="color:#555">=</span><span style="color:#c30">&#34;GET&#34;</span>&gt;
            &lt;<span style="color:#309;font-weight:bold">input</span> <span style="color:#309">type</span><span style="color:#555">=</span><span style="color:#c30">&#34;txt&#34;</span> <span style="color:#309">name</span><span style="color:#555">=</span><span style="color:#c30">&#34;f&#34;</span>&gt;
            &lt;<span style="color:#309;font-weight:bold">input</span> <span style="color:#309">type</span><span style="color:#555">=</span><span style="color:#c30">&#34;submit&#34;</span> <span style="color:#309">value</span><span style="color:#555">=</span><span style="color:#c30">&#34;Read&#34;</span>&gt;
        &lt;/<span style="color:#309;font-weight:bold">form</span>&gt;
    &lt;/<span style="color:#309;font-weight:bold">body</span>&gt;
&lt;/<span style="color:#309;font-weight:bold">html</span>&gt;</code></pre></td></tr></table>
</div>
</div><br />
Moving on&hellip; let&rsquo;s check the i/o of that input box</p>

<p>Entering <code>abc</code> returns a 404:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">Not Found
The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</code></pre></div>
<p>Likewise other words, <code>flag</code>, <code>flag.txt</code> return a 404.</p>

<p>At this point one has to make a decision. Brute force, i.e., throw a word-list at the problem or continue pounding your head.</p>

<p>Took a step back, re-re-read the FAQ for inspiration and reiterated what I already knew. Brute-forcing is almost always not the right solution:</p>

<p>A good CTF challenge doesn&rsquo;t require a lot of guessing, in that it should be quite clear what is the problem to solve after a short time looking at it</p>

<p>Some google searches later, some more prodding, it&rsquo;s starting to feel like a local file inclusion challenge.</p>

<p><code>/etc/passwd</code> (very common file on *nix system) yielded interesting output:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
...</code></pre></div>
<p>Could spend days guessing location of the flag file, but deep down you know the answer is &hellip;</p>

<p><iframe src="https://giphy.com/embed/d1E1msx7Yw5Ne1Fe" width="auto" height="240" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/buschbeer-beer-d1E1msx7Yw5Ne1Fe"></a></p></p>

<p>We know a valid file path will echo the contents of a file. Since there are a lot of files it makes sense to get an idea of where we are and what&rsquo;s running.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">/etc/issue
Debian GNU/Linux <span style="color:#f60">8</span> <span style="color:#fc3">\</span>n <span style="color:#fc3">\</span>l</code></pre></div><div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">/etc/debian_version
<span style="color:#f60">8</span>.<span style="color:#f60">8</span></code></pre></div>
<p>So we have Debian &ldquo;jessie&rdquo;, which gives an idea what linux files we may expect. Check out <a href="http://www.pathname.com/fhs/">FHS</a> for more info.</p>

<p>After more probing and information gathering I moved on to <code>/proc</code>, a special-purpose filesystem that contains info about currently running processes and kernel parameters. Inspiration from <a href="https://www.linux.com/news/discover-possibilities-proc-directory">Discover the possibilities of the /proc directory</a></p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">/proc/version
Forbidden
You don<span style="color:#a00;background-color:#faa">&#39;</span>t have the permission to access the requested resource. It is either read-protected or not readable by the server.</code></pre></div>
<p><strong>Woaaaaahh!!</strong> This is unusual and whenever you see something unusual it gets exciting. Do we need root, issues with mounting /proc? This post is getting long so I&rsquo;ll gloss over some bits.</p>

<p><code>/etc</code> returns 404 and <code>/proc</code> returns 403</p>

<p>After a bunch of tinkering it became apparent the string &lsquo;proc&rsquo; was getting filtered. Mash <code>lkkljhdfproc</code> on your keyboard and it&rsquo;ll return 403.</p>

<p>More inspiration. <a href="https://blogs.oracle.com/ksplice/solving-problems-with-proc">Solving problems with proc</a>, specifically Redirect harder:</p>

<p>Most UNIX tools can read from standard input, either by default or with a specified filename of &ldquo;-&rdquo;. But sometimes we have to use a program which requires an explicitly named file. proc provides an elegant workaround for this flaw.</p>

<p>A UNIX process refers to its open files using integers called file descriptors. When we say &ldquo;standard input&rdquo;, we really mean &ldquo;file descriptor 0&rdquo;. So we can use /proc/self/fd/0 as an explicit name for standard input:</p>

<blockquote>
<p><strong>This trick is useful enough that many distributions provide symlinks at /dev/stdin, etc.</strong></p>
</blockquote>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l /dev/stdin
lrwxrwxrwx <span style="color:#f60">1</span> root root <span style="color:#f60">15</span> Jun <span style="color:#f60">25</span> <span style="color:#f60">10</span>:04 /dev/stdin -&gt; /proc/self/fd/0</code></pre></div>
<p>Is it possible we can get access to <code>/proc</code> via the <code>/dev</code> symlinks?</p>

<p>At this point it was getting frustrating [see update below]. <code>stderr</code> and <code>stdout</code> also returned 403. mindreader was not liking specific keywords. <code>stdin</code> was an okay keyword but cannot be used.</p>

<p>Long story needs to have an ending, <a href="http://poincare.matf.bg.ac.rs/~ivana/courses/tos/sistemi_knjige/pomocno/apue/APUE/0201433079/toc.html">Advanced Programming in the UNIX Environment</a> specifically <a href="http://poincare.matf.bg.ac.rs/~ivana/courses/tos/sistemi_knjige/pomocno/apue/APUE/0201433079/ch03lev1sec16.html">3.16 /dev/fd</a> was THE article to point the compass home.</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls -l /dev/fd
lrwxrwxrwx <span style="color:#f60">1</span> root root <span style="color:#f60">13</span> Jun <span style="color:#f60">25</span> <span style="color:#f60">10</span>:04 /dev/fd -&gt; /proc/self/fd</code></pre></div>
<p>We can use <code>/dev/fd</code> symlink to access <code>/proc/</code> without .. typing .. in .. &lsquo;proc&rsquo;</p>

<p><code>/dev/fd/../../version</code></p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Linux version 3.16.0-4-amd64 (debian-kernel@lists.debian.org) (gcc version 4.8.4 (Debian 4.8.4-1) ) #1 SMP Debian 3.16.43-2 (2017-04-30)</code></pre></div>
<p>FINALLY !!!! we can access <code>/proc</code></p>

<p>Clearly mindreader made it difficult to get here, so now that we&rsquo;re here let&rsquo;s explore. With enough probing you&rsquo;ll eventually come across <code>environ</code>, this Red Hat <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/3/html/Reference_Guide/s1-proc-directories.html">Chapter 5. The proc File System</a> was useful.</p>

<p>Some more probing and testing of various processes will lead to:</p>

<p><code>/dev/fd/../environ</code></p>

<p><strong>FLAG=CTF{ee02d9243ed6dfcf83b8d520af8502e1}</strong></p>

<p><strong>UPDATE</strong> I never got to the bottom of why some keywords were filtered. Here is a great explanation <a href="https://youtu.be/KvyBn4Btv8E?t=37m29s">Hacking Livestream #23: Google CTF Quals 2017</a></p>
 
                </div>
            </div>
        </div>


    </div>

    <div class="text-center">
        <footer class="footer">
    Made with
    <a href="https://gohugo.io">Hugo</a> and hosted by
    <a href="https://github.com"> 
        <img src="https://mfridman.github.com/frid.io/svg/github.svg" alt="" width="24px">
    </a>
</footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
    crossorigin="anonymous"></script>
</body>

</html>